#!/bin/bash

doit() {
	cp "from/$1.oramap" "$1.oramap"
  	NAME=$1
  	# ID=$1
  	# echo ID=$ID
  	# wget http://resource.openra.net/map/id/$ID -O "$ID.dat"
  	# #cat "$ID.dat" | grep "\"title\""
  	# NAME=$(cat "$ID.dat" | grep "\"title\"")
  	# NAME=$(echo ${NAME} | cut -d ' ' -f 2 | cut -d '"' -f 2)
  	# echo NAME=$NAME
  	# wget "https://resource.openra.net/maps/$1/oramap" -O "$NAME.oramap"
  	unzip "$NAME.oramap" -d "$NAME" map.*
#exit
	while IFS= read -r line
	do
	  FIRST=$(echo ${line} | cut -d ' ' -f 1)
	  if 	[[ "$FIRST" == "Title:" ]] ; then
#	  	#echo $line
		line=$(echo "$line" | sed "s/Title: /Title: STRIPPED-/gI")

#	  	line="Title: WW3 v3.0.7 $NAME"
	  fi
#	  if 	[[ "$FIRST" == "Author:" ]] ; then
#	  	#echo $line
#	  	line="Author: H + Waggy + Me"
#	  fi

	  if 	[[ "$FIRST" == "Rules:" ]] || \
	  		[[ "$FIRST" == "Sequences:" ]] || \
	  		[[ "$FIRST" == "Weapons:" ]] || \
	  		[[ "$FIRST" == "Voices:" ]] ||
	  		[[ "$FIRST" == "Notifications:" ]] ; then
		  #echo "BREAK"
		  break
	  fi
	  echo "$line" >> "$NAME/map.yaml.new"
	done < "$NAME/map.yaml"
# echo "Rules: WW3_Defaults.yaml, WW3_Aircraft.yaml, WW3_Buildings.yaml, WW3_Infantry.yaml, WW3_Misc.yaml, WW3_Ships.yaml, WW3_Vehicles.yaml, WW3_Briefing.yaml, plains.yaml, ai.yaml" >> "$NAME/map.yaml.new"
# echo "" >> "$NAME/map.yaml.new"
# echo "Sequences: sequences.yaml" >> "$NAME/map.yaml.new"
# echo "" >> "$NAME/map.yaml.new"
# echo "Weapons: WW3_Weapons.yaml" >> "$NAME/map.yaml.new"
# echo "" >> "$NAME/map.yaml.new"
# echo "Voices: WW3_Voices.yaml" >> "$NAME/map.yaml.new"
# echo "" >> "$NAME/map.yaml.new"
# echo "Notifications: notifications.yaml" >> "$NAME/map.yaml.new"

URL=$(cat "$NAME/map.yaml.new" | sed "s/railturr/pbox/" | sed "s/htur/gun/" > "$NAME/map.yaml")

rm "$NAME/map.yaml.new"
# rm "$NAME/map.yaml"
# mv "$NAME/map.yaml.new" "$NAME/map.yaml"

#cp BASE/* "$NAME" -R

cd "$NAME"
NEWNAME=$(echo $NAME | sed "s/ww3/ww0/gI")

zip "../new/$NEWNAME.oramap" * -r # -u
cd ..
rm -rf "$NAME"
rm "$1.oramap"
}

doit "48855"
doit "48947"
doit "48995"
doit "48997"
doit "49023"
doit "49029"
doit "49051"
doit "49082"
doit "49087"
doit "49089"
doit "49104"
doit "49110"
doit "49144"
doit "49165"
doit "49198"
doit "49205"
doit "49212"
doit "49222"
doit "49276"
doit "49297"
doit "49420"
doit "49422"
doit "49429"
doit "49433"
doit "49440"
doit "49448"
doit "49456"
doit "49462"
doit "49480"
doit "49485"
doit "49500"
doit "49505"
doit "49507"
doit "49511"
doit "49525"
doit "49526"
doit "49552"
doit "49553"
doit "49584"
doit "49591"
doit "49592"
doit "49594"
doit "49596"
doit "49603"
doit "49632"
doit "49657"
doit "49667"
doit "49846"
doit "49850"
doit "49858"
doit "49873"
doit "49875"
doit "49911"
doit "51426"
doit "51445"
doit "51446"
doit "51447"
doit "51455"
doit "51470"
doit "51554"
doit "51556"
doit "51558"
doit "51563"
doit "51593"
doit "51597"
doit "51604"
doit "51660"
doit "51682"
doit "51698"
doit "51699"
doit "51701"
doit "51704"
doit "51720"
doit "51744"
doit "51811"
doit "51816"
doit "51832"
doit "51833"
doit "51840"
doit "51841"
doit "51846"
doit "51849"
doit "51851"
doit "51852"
doit "51853"
doit "51897"
doit "51909"
doit "51912"
doit "51936"
doit "51948"
doit "52186"
doit "52241"
doit "52249"
doit "52322"
doit "52419"
doit "52422"
doit "52443"
doit "52710"
doit "52730"
doit "52733"
doit "52751"
doit "52753"
doit "52782"
doit "52794"
doit "52817"
doit "52828"
doit "52829"
doit "52867"
doit "52877"
doit "52889"
doit "52895"
doit "52899"
doit "52904"
doit "52912"
doit "52913"
doit "52914"
doit "52917"
doit "52919"
doit "53010"
doit "53019"
doit "53033"
doit "53045"
doit "53050"
doit "53054"
doit "53055"
doit "53067"
doit "53074"
doit "53085"
doit "53086"
doit "53090"
doit "53098"
doit "53128"
doit "53131"
doit "53133"
doit "53136"
doit "53139"
doit "53146"
doit "53147"
doit "53150"
doit "53159"
doit "53160"
doit "53161"
doit "53164"
doit "53171"
doit "53172"
doit "53173"
doit "53174"
doit "53182"
doit "53189"
doit "53192"
doit "53236"
doit "53303"
doit "53304"
doit "53371"
doit "53386"
doit "53387"
doit "53397"
doit "53399"
doit "53423"
doit "53442"
doit "53443"
doit "53445"
doit "53461"
doit "53462"
doit "53477"
doit "53593"
doit "53633"
doit "53637"
doit "53638"
doit "53639"
doit "53651"
doit "53710"
doit "53753"
doit "53763"
doit "53764"
doit "53792"
doit "53803"
doit "53808"
doit "53826"
doit "54623"
doit "54733"
doit "54734"
doit "54743"
doit "54744"
doit "54764"
doit "54767"
doit "54768"
doit "54772"
doit "54838"
doit "54908"
doit "54914"
doit "54915"
doit "54916"
doit "54917"
doit "54918"
doit "54919"
doit "54920"
doit "54927"
doit "54928"
doit "54931"
doit "54932"
doit "54946"
doit "54947"
doit "54948"
doit "54952"
doit "54957"
doit "55097"
doit "55248"
doit "55255"
doit "55302"
doit "55303"
doit "55365"
doit "55415"
doit "55426"
doit "55433"
doit "55518"
doit "55534"
doit "55546"
doit "55579"
doit "55588"
doit "55593"
doit "55601"
doit "55626"
doit "55627"
doit "55628"
doit "55641"
doit "55650"
doit "55651"
doit "55762"
doit "55768"
doit "55791"
doit "55801"
doit "55835"
doit "55844"
doit "55845"
doit "55846"
doit "55847"
doit "55848"
doit "55858"
doit "55859"
doit "55860"
doit "55861"
doit "55862"
doit "55866"
doit "55867"
doit "55886"
doit "55887"
doit "55899"
doit "55905"
doit "55909"
doit "55910"
doit "55911"
doit "55912"
doit "55913"
doit "55914"
doit "55915"
doit "55916"
doit "55917"
doit "55918"
doit "55919"
doit "55920"
doit "55921"
doit "55922"
doit "55923"
doit "55924"
doit "55926"
doit "55927"
doit "55928"
doit "55929"
doit "55930"
doit "55931"
doit "55932"
doit "55933"
doit "55935"
doit "55936"
doit "55937"
doit "55939"
doit "55940"
doit "55941"
doit "55942"
doit "55943"
doit "55944"
doit "55945"
doit "55946"
doit "55947"
doit "55948"
doit "55949"
doit "55950"
doit "55951"
doit "55952"
doit "55953"
doit "55954"
doit "55955"
doit "55956"
doit "55957"
doit "55958"
doit "55989"
doit "55990"
doit "55994"
doit "56014"
doit "56017"
doit "56021"
doit "56022"
doit "56055"
doit "56059"
doit "56112"
doit "56115"
doit "56119"
doit "56126"
doit "56135"
doit "56160"
doit "56162"
doit "56163"
doit "56215"
doit "56216"
doit "56218"
doit "56235"
doit "56238"
doit "56239"
doit "56254"
doit "56255"
doit "56257"
doit "56258"
doit "56260"
doit "56265"
doit "56268"
doit "56287"
doit "56290"
doit "56298"
doit "56357"
doit "56428"
doit "56456"
doit "56457"
doit "56458"
doit "56459"
doit "56460"
doit "56488"
doit "56495"
doit "56496"
doit "56497"
doit "56520"
doit "56521"
doit "56522"
doit "56523"
doit "56547"
doit "56592"
doit "56627"
doit "56636"
doit "56646"
doit "56849"
doit "57217"
doit "57233"
doit "57234"
doit "57236"
doit "57268"
doit "57269"
doit "57270"
doit "57271"
doit "57280"
doit "57297"
doit "57300"
doit "57302"
doit "57357"
doit "57358"
doit "57480"
doit "57524"
doit "57543"
doit "57547"
doit "57549"
doit "57550"
doit "57553"
doit "57718"
doit "57727"
doit "57734"
doit "57735"
doit "57823"
doit "57824"
doit "57825"
doit "57826"
doit "57827"
doit "57876"
doit "57880"
doit "57890"
doit "57892"
doit "58109"
doit "58113"
doit "58124"
doit "58127"
doit "58129"
doit "58142"
doit "59017"
doit "59018"
doit "59087"
doit "59090"
doit "59099"
doit "59100"
doit "59117"
doit "59122"
doit "59150"
doit "59151"
doit "59152"
doit "59158"
doit "59171"
doit "59174"
doit "59208"
doit "59209"
doit "59237"
doit "59238"
doit "59277"
doit "59279"
doit "59348"
doit "59349"
doit "59502"
doit "59508"